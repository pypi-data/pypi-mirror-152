function Card(n,t){this.suit=n;this.rank=t;this.getSuit=function(){return this.suit};this.getRank=function(){return this.rank};this.getIndex=function(){return(this.suit<<4)+this.rank};this.setIndex=function(n){this.suit=n>>4;this.rank=n%16}}function Bid(){this.type=BidType.Pass;this.index=0;this.alert=!1;this.getType=function(){return this.type};this.getIndex=function(){return this.index};this.getRank=function(){return Math.floor(this.index/5)+1};this.getTrump=function(){return this.index%5};this.isAlert=function(){return this.alert}}function DirectionAdd(n,t){return(n+t)%4}function DirectionDistance(n,t){return(t-n+4)%4}function IsVulnerability(n,t){return n==Vulnerability.Both||t%2==n-1}var SuitValue={Club:0,Diamond:1,Heart:2,Spade:3,NoTrump:4},RankValue={RV_Invalid:-1,RV_2:0,RV_3:1,RV_4:2,RV_5:3,RV_6:4,RV_7:5,RV_8:6,RV_9:7,RV_T:8,RV_J:9,RV_Q:10,RV_K:11,RV_A:12},Direction={NoDirection:-1,South:0,West:1,North:2,East:3},Vulnerability={None:0,NS:1,EW:2,Both:3},BidType={Normal:0,Pass:1,Double:2,Redouble:3,NotContract:4},ProtocolCodec={SuitStr:["C","D","H","S","N"],RankStr:["2","3","4","5","6","7","8","9","T","J","Q","K","A"],PassStr:"P",DoubleStr:"X",RedoubleStr:"XX",SuitSortCardsRnk:[[0,3,1,2],[3,0,2,1],[3,2,0,1],[2,3,1,0],[2,3,1,0]],DirectionFromString:function(n){return n=="N"?Direction.North:n=="S"?Direction.South:n=="E"?Direction.East:n=="W"?Direction.West:Direction.NoDirection},DirectionToString:function(n){return n==Direction.North?"N":n==Direction.South?"S":n==Direction.East?"E":n==Direction.West?"W":""},VulnerabilityFromString:function(n){return n=="NS"?Vulnerability.NS:n=="EW"?Vulnerability.EW:n=="All"?Vulnerability.Both:Vulnerability.None},ContractFromString:function(n){var i=new Bid,t;if(n.length>=2){var u=n.charAt(0),f=n.charAt(1),r=SuitValue.NoTrump;for(t=0;t<4;t++)f==ProtocolCodec.SuitStr[t]&&(r=t);i.index=(u-1)*5+r;i.type=n.charAt(2)=="X"?n.charAt(3)=="X"?BidType.Redouble:BidType.Double:BidType.Normal}else i.type=BidType.NotContract;return i},BidFromString:function(n){var t=new Bid,r=n.length,i;if(n.charAt(r-1)=="A"&&(t.alert=!0,n=n.substr(0,r-1)),n==ProtocolCodec.PassStr)t.type=BidType.Pass;else if(n==ProtocolCodec.DoubleStr)t.type=BidType.Double;else if(n==ProtocolCodec.RedoubleStr)t.type=BidType.Redouble;else{var f=n.charAt(0),e=n.charAt(1),u=SuitValue.NoTrump;for(i=0;i<4;i++)e==ProtocolCodec.SuitStr[i]&&(u=i);t.index=(f-1)*5+u;t.type=BidType.Normal}return t},BidToString:function(n){return n.type==BidType.Pass?ProtocolCodec.PassStr:n.type==BidType.Double?ProtocolCodec.DoubleStr:n.type==BidType.Redouble?ProtocolCodec.RedoubleStr:n.getRank()+ProtocolCodec.SuitStr[n.getTrump()]},CardFromString:function(n){for(var i=new Card,r=n.charAt(0),u=n.charAt(1),t=0;t<13;t++)if(r==ProtocolCodec.RankStr[t]){i.rank=t;break}for(t=0;t<4;t++)if(u==ProtocolCodec.SuitStr[t]){i.suit=t;break}return i},CardToString:function(n){return ProtocolCodec.RankStr[n.getRank()]+ProtocolCodec.SuitStr[n.getSuit()]},HandFromString:function(n,t){for(var i=SuitValue.Spade,r=0;r<n.length;r++)switch(n.charAt(r)){case"2":t.push(new Card(i,RankValue.RV_2));break;case"3":t.push(new Card(i,RankValue.RV_3));break;case"4":t.push(new Card(i,RankValue.RV_4));break;case"5":t.push(new Card(i,RankValue.RV_5));break;case"6":t.push(new Card(i,RankValue.RV_6));break;case"7":t.push(new Card(i,RankValue.RV_7));break;case"8":t.push(new Card(i,RankValue.RV_8));break;case"9":t.push(new Card(i,RankValue.RV_9));break;case"T":t.push(new Card(i,RankValue.RV_T));break;case"J":t.push(new Card(i,RankValue.RV_J));break;case"Q":t.push(new Card(i,RankValue.RV_Q));break;case"K":t.push(new Card(i,RankValue.RV_K));break;case"A":t.push(new Card(i,RankValue.RV_A));break;case".":i--}},BidLogFromString:function(n,t){var r=n.replace(/;/g,",").split(","),u,i;for(u in r)(i=r[u],i.length!=0)&&t.push(ProtocolCodec.BidFromString(i))},PlayLogFromString:function(n,t,i){var e=n.split(";"),o,u,f,s,r;for(o in e)if(u=e[o],u.length==13)for(f=u.split(":"),i.push(ProtocolCodec.DirectionFromString(f[0])),s=f[1].split(","),r=0;r<4;r++)t.push(ProtocolCodec.CardFromString(s[r]))}}