(()=>{var w=Object.defineProperty;var p=Object.getOwnPropertySymbols;var y=Object.prototype.hasOwnProperty,b=Object.prototype.propertyIsEnumerable;var f=(e,t,n)=>t in e?w(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,h=(e,t)=>{for(var n in t||(t={}))y.call(t,n)&&f(e,n,t[n]);if(p)for(var n of p(t))b.call(t,n)&&f(e,n,t[n]);return e};var g=(e,t)=>{var n={};for(var r in e)y.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&p)for(var r of p(e))t.indexOf(r)<0&&b.call(e,r)&&(n[r]=e[r]);return n};var s={init(){Alpine.magic("static",()=>s.$static)},$static(){return e=>window.__tetra_staticRoot+e},alpineComponentMixins(){return{init(){this.$dispatch("tetra:child-component-init",{component:this}),this.__initServerWatchers(),this.__initInner&&this.__initInner()},destroy(){this.$dispatch("tetra:child-component-destroy",{component:this}),this.__destroyInner&&this.__destroyInner()},updateHtml(e){Alpine.morph(this.$root,e,{updating(t,n,r,a){if(n.hasAttribute&&n.hasAttribute("x-data-maintain")&&t.hasAttribute&&t.hasAttribute("x-data"))n.setAttribute("x-data",t.getAttribute("x-data")),n.removeAttribute("x-data-maintain");else if(n.hasAttribute&&n.hasAttribute("x-data-update")&&t.hasAttribute&&t.hasAttribute("x-data")){let o=s.jsonDecode(n.getAttribute("x-data-update")),c=s.jsonDecode(n.getAttribute("x-data-update-old")),i=window.Alpine.$data(t);for(let d in o)c.hasOwnProperty(d)&&c[d]!==i[d]||(i[d]=o[d]);n.setAttribute("x-data",t.getAttribute("x-data")),n.removeAttribute("x-data-update")}},lookahead:!0})},updateData(e){for(let t in e)this[t]=e[t]},removeComponent(){this.$root.remove()},replaceComponentAndState(e){this.$root.insertAdjacentHTML("afterend",e),this.$root.remove()},__initServerWatchers(){this.__serverMethods.forEach(e=>{e.watch&&e.watch.forEach(t=>{this.$watch(t,async(n,r)=>{await this[e.name](n,r,t)})})})},__childComponents:{},__rootBind:{["@tetra:child-component-init"](e){e.stopPropagation();let t=e.detail.component;t.key!==this.key&&(t.key&&(this.__childComponents[t.key]=t),t.__parentComponent=this)},["@tetra:child-component-destroy"](e){e.stopPropagation();let t=e.detail.component;t.key!==this.key&&(delete this.__childComponents[t.key],e.detail.component.__parentComponent=null)}}}},makeServerMethods(e){let t={};return e.forEach(n=>{var r=async function(...a){return await s.callServerMethod(this,n.name,n.endpoint,a)};n.debounce?r=s.debounce(r,n.debounce,n.debounce_immediate):n.throttle&&(r=s.throttle(r,n.throttle,{leading:n.throttle_leading,trailing:n.throttle_trailing})),t[n.name]=r}),t},makeAlpineComponent(e,t,n,r){Alpine.data(e,a=>{let l=t,{init:o,destroy:c}=l,i=g(l,["init","destroy"]),d=s.jsonDecode(a);return h(h(h(h({componentName:e,__initInner:o,__destroyInner:c,__serverMethods:n,__serverProperties:r},d||{}),i),s.makeServerMethods(n)),s.alpineComponentMixins())})},getStateWithChildren(e){let t={};e.__serverProperties.forEach(r=>{t[r]=e[r]});let n={state:e.__state,data:t,children:[]};for(let r in e.__childComponents){let a=e.__childComponents[r];n.children.push(s.getStateWithChildren(a))}return n},loadScript(e){return new Promise((t,n)=>{let r=document.createElement("script");r.src=e,r.onload=t,r.onerror=n,document.head.appendChild(r)})},loadStyles(e){return new Promise((t,n)=>{let r=document.createElement("link");r.href=e,r.rel="stylesheet",r.type="text/css",r.onload=t,r.onerror=n,document.head.appendChild(r)})},async callServerMethod(e,t,n,r){body=s.getStateWithChildren(e),body.args=r;let a=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":window.__tetra_csrfToken},mode:"same-origin",body:s.jsonEncode(body)});if(a.status===200){let o=s.jsonDecode(await a.text());if(o.success){let c=[];return o.js.forEach(i=>{document.querySelector(`script[src="${CSS.escape(i)}"]`)||c.push(s.loadScript(i))}),o.styles.forEach(i=>{document.querySelector(`link[href="${CSS.escape(i)}"]`)||c.push(s.loadStyles(i))}),await Promise.all(c),o.callbacks&&o.callbacks.forEach(i=>{e[i.callback](...i.args)}),o.result}else throw new Error("Error processing public method")}else throw new Error(`Server responded with an error ${a.status} (${a.statusText})`)},jsonReplacer(e,t){return t instanceof Date?{__type:"datetime",value:t.toISOString()}:t instanceof Set?{__type:"set",value:Array.from(t)}:t},jsonReviver(e,t){if(t&&typeof t=="object"&&t.__type){if(t.__type==="datetime")return new Date(t);if(t.__type==="set")return new Set(t)}return t},jsonEncode(e){return JSON.stringify(e,s.jsonReplacer)},jsonDecode(e){var t=JSON.parse(e,s.jsonReviver);return t},debounce(e,t,n){var r;return function(){var a=this,o=arguments,c=function(){r=null,n||e.apply(a,o)},i=n&&!r;clearTimeout(r),r=setTimeout(c,t),i&&e.apply(a,o)}},throttle(e,t,n){var r,a,o,c,i=0;n||(n={});var d=function(){i=n.leading===!1?0:now(),r=null,c=e.apply(a,o),r||(a=o=null)},u=function(){var l=new Date().getTime();!i&&n.leading===!1&&(i=l);var m=t-(l-i);return a=this,o=arguments,m<=0||m>t?(r&&(clearTimeout(r),r=null),i=l,c=e.apply(a,o),r||(a=o=null)):!r&&n.trailing!==!1&&(r=setTimeout(d,m)),c};return u.cancel=function(){clearTimeout(r),i=0,r=a=o=null},u}},_=s;window.Tetra=_;window.document.addEventListener("alpine:init",()=>{_.init()});})();
//# sourceMappingURL=tetra.min.js.map
