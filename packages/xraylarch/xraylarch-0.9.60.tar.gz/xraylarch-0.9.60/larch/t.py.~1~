import wxmplot

from ..site_config import get_homedir

Valid_DataTypes = ('string', 'float', 'int', 'positive_int',
                   'bool', 'choice', 'path')
class Var:
    """configuration variable"""
    def __init__(self, name, default, dtype, choices=None, desc='a variable'):
        self.name = name
        self.value = value
        self.dtype = dtype
        self.choices = choices
        self.desc = desc

        if dtype not in Valid_DataTypes:
            raise ValueError(f"unknown configuration type '{dtype}' for '{name}'")

        if dtype == 'choice' and self.choices is None:
            raise ValueError(f"choice configuration type must have choices for '{name}'")



_main = [Var('chdir_on_fileopen', True, 'bool', desc='whether to change directory when opening a file'),
         Var('workdir', get_homedir(), 'path', desc='staring working directory')]



autosave = [Var('savetime', 900, 'positive_int', desc='time (in sec) between auto-saving Project files'),
            Var('nhistory', 3, 'positive_int', desc='number of auto-saved Project files to keep'),
            Var('fileroot', 'session_autosave', 'string', desc='filename prefix for auto-saved Project files')]



pin = [Var('style', 'pin first', 'choice', choices=['pin first', 'plot first'],
           desc='whether to click on pin first, then plot or plot first, then pin'),
       Var('min_time', 2.0, 'float',
           desc='minimum time (seconds) between clicking on the pin and reporting a value, allowing multiple clicks on the plot in that time'),
       Var('max_time', 15.0, 'float',
           desc='maximum time (seconds) after clicking on the pin to click on plot - will report last saved value')

plot = [Var('theme', 'light', 'choice', choices=list(wxmplot.config.Themes.keys()),
            desc='plotting theme for colors and "look and feel"'),
        Var('height', 550, 'positive_int', desc='height of main plot window (in pixels)'),
        Var('width', 600, 'positive_int', desc='width of main plot window (in pixels)'),
        Var('show_grid', True, 'bool', desc='whether to show grid lines'),
        Var('show_fullbox', True, 'bool', desc='whether to show a full box around plot, or only left and bottom axes'),
        ]



    'plot_config': {'height': 550, 'theme': 'light', 'width': 600},

    'prepeaks_config': {'e': None, 'ehi': -5, 'elo': -10, 'emax': 0,
                        'emin': -40, 'yarray': 'norm'},

XASCONF = {}
for v in _main:
    XASCONF[v.name] = v.value

for section in ('autosave', 'pin', 'plot'):
    XASCONF[section] = {}
    for v in locals[section]:
        XASCONF[section][v.name] = v.value

XASCONF = { # default configurations
    'autosave_config': {'savetime': 900, 'nhistory': 3,
                        'fileroot': 'session_autosave'},

    'chdir_on_fileopen': True,

    'exafs_config': {'bkg_clamphi': 1, 'bkg_clamplo': 0, 'bkg_kmax': None,
                     'bkg_kmin': 0, 'bkg_kweight': 2, 'e0': -1.0,
                     'fft_dk': 4, 'fft_dr': 0.25, 'fft_kmax': None,
                     'fft_kmin': 2.5, 'fft_kweight': 2,
                     'fft_kwindow': 'Kaiser-Bessel',
                     'fft_rmax': 6, 'fft_rmin': 1, 'fft_rwindow':
                     'Hanning', 'rbkg': 1},

    'feffit_config': {'dk': 4, 'fitspace': 'r', 'kmax': None, 'kmin': 2,
                      'kwindow': 'Kaiser-Bessel', 'kwstring': '2',
                      'rmax': 4, 'rmin': 1},

    'lincombo_config': {'all_combos': True, 'ehi': 99999, 'ehi_rel': 110,
                        'elo': -99999, 'elo_rel': -40,
                        'fitspace': 'Normalized μ(E)', 'show_e0': False,
                        'show_fitrange': True, 'sum_to_one': False,
                        'vary_e0': False},

    'pca_config': {'fitspace': 'Normalized μ(E)',
                   'max_components': 20, 'weight_auto': True,
                   'weight_min': 0.001, 'xmax': 99999, 'xmin': -99999},

    'pin_config': {'min_time': 2.0, 'style': 'pin_first', 'timeout': 15.0},

    'plot_config': {'height': 550, 'theme': 'light', 'width': 600},

    'prepeaks_config': {'e': None, 'ehi': -5, 'elo': -10, 'emax': 0,
                        'emin': -40, 'yarray': 'norm'},

    'regression_config': {'alpha': 0.01, 'cv_folds': None,
                          'cv_repeats': 3, 'fit_intercept': True,
                          'fitspace': 'Normalized μ(E)', 'scale': True,
                          'use_lars': True, 'varname': 'valence',
                          'xmax': 99999, 'xmin': -99999},

    'workdir': '/Users/Newville/Codes/xraylarch',

    'xasnorm_config': {'auto_e0': True, 'auto_step': True,
                       'e0': 0, 'edge': 'K', 'edge_step': None,
                       'energy_ref': None, 'energy_shift': 0,
                       'nnorm': None, 'norm1': None, 'norm2': None,
                       'norm_method': 'polynomial', 'nvict': 0,
                       'pre1': None, 'pre2': None, 'scale': 1, 'show_e0': True},
    }

CONF_FILE = 'xas_viewer.conf'
